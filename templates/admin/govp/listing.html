<div class="wrap">
  <h2>
    Contributions
    <a href="javascript:add_new_contrib()" class="add-new-h2">Add New</a>
  </h2>

  <ul class="subsubsub">
    <li>
      <a {% if theme == '' %}class="current"{% endif %}
         href="{{ pageurl }}&theme=">
        All <span class="count">({{ total_count }})</span> |
      </a>
    </li>

    {% for i in themes %}
    <li>
      <a href="{{ pageurl }}&theme={{ i }}"
         {% if theme == i %}class="current"{% endif %}>
        {{ i }}
        <span class="count">({{ themecounts[i] }})</span>
      </a>

      {% if loop.index != themes|length %}|{% endif %}
    </li>
    {% endfor %}
  </ul>


  <form
     id="search" method="get" action="{{ pageurl }}"
     onsubmit="window.location.href+='&s='+document.forms.search.s.value; return false">
    <p class="search-box">
      <label class="screen-reader-text" for="search-input">
        Search Colaborations:
      </label>
      <input type="text" id="search_input" name="s" value="{{ s }}">
      <input
         type="submit" name="" id="search-submit" class="button"
         value="Search">
    </p>
  </form>

  <div class="tablenav top">
    <div class="alignright actions">
      <label>
        {% if status == 'true' %}
        <strong>Approved</strong>
        {% else %}
        <a href="{{ pageurl }}&status=true">Approved</a>
        {% endif %}
      </label>
      |
      <label>
        {% if status == 'false' %}
        <strong>Not approved</strong>
        {% else %}
        <a href="{{ pageurl }}&status=false">Not approved</a>
        {% endif %}
      </label>
      |
      <label>
        <a href="{{ pageurl }}&status=">All</a>
      </label>
    </div>
  </div>

  <div class="wpgd-new-contrib stuffbox" style="display:none">
    <form class="form-wrap">
      <div class="form-field">
        <label for="theme">Theme</label>
        <select class="wpgd-theme" name="theme">
          <option name="cuidado">cuidado</option>
          <option name="familia">familia</option>
          <option name="emergencia">emergencia</option>
          <option name="medicamentos">medicamentos</option>
          <option name="regional">regional</option>
        </select>
      </div>
      <div class="form-field">
        <label for="title">Title</label>
        <input type="text" name="title" style="width:518px">
      </div>
      <div class="form-field">
        <label for="content">Content</label>
        <textarea name="content" style="width:500px;height:200px"
                  maxlength="600"> </textarea>
      </div>
      <div class="form-field">
        <label for="part">Part of</label>
        <input type="text" name="part" style="width:518px">
      </div>
    <input type="button" name="OK" class="button" value="OK">
    <input type="button" name="Cancel" class=" button" value="Cancel">
    </form>
  </div>

  <div class="wpgd-status-bar">loading...</div>
  <div class="wp-list-table-loading">Loading contributions...</div>
  <table class="wp-list-table widefat fixed audiences" style="display:none"
         cellspacing="0">
    <thead>
      <tr>
        <th style="width:5%"><a href="{{pageurl}}&sort=id">ID</a></th>
        <th style="width:7%"><a href="{{pageurl}}&sort=status">Approved?</a></th>
        <th style="width:8%">Duplicate</th>
        <th style="width:8%">Part of</th>
        <th style="width:10%"><a href="{{pageurl}}&sort=theme">Theme</a></th>
        <th class="column-date" style="width:8%">
          <a href="{{pageurl}}&sort=date">Creation date</a></th>
        <th style="width:10%"><a href="{{pageurl}}&sort=author">Author</a></th>
        <th style="width:15%"><a href="{{pageurl}}&sort=title">Title</a></th>
        <th>Content</th>
      </tr>
    </thead>
    <tbody id="contrib-rows">
      {% for contrib in listing %}

        {% if (contrib.parent != 0) or (contrib.part != 0) %}
          {% if contrib.part != 0 %}
           {% set apr = "wpgd-part-approved" %}
          {% else %}
           {% set apr = "" %}
          {% endif %}
        {% else %}
          {% set apr = "" %}
          {% if contrib.status == 1 %}
           {% set apr = "wpgd-approved" %}
          {% endif %}
          {% if contrib.status == 0 %}
           {% set apr = "wpgd-disapproved" %}
          {% endif %}
        {% endif %}

        {% if (contrib.parent == 0) and (contrib.part == 0) %}
         {% set prt = "" %}
        {% else %}
          {% if (contrib.parent == 0) %}
            {% set prt = "is-duplicate duplicate-of-" ~ contrib.parent %}
          {% else %}
            {% set prt = "is-part part-of-" ~ contrib.part %}
          {% endif %}
        {% endif %}
      <tr class="{{apr}} {{prt}}" id="row-{{ contrib.id }}">

        <td class="contrib-id">
          <a class="delete-contrib" href="{{contrib.id}}">X</a>
          {{ contrib.id }}
        </td>

        <td class="contrib-status"
            id="contrib-status[{{contrib.id}}]">
          <input type="checkbox"
                 {% if contrib.parent != 0 %}
                 style="display:none"
                 {% endif %}
                 {{contrib.status|replace({1:'checked',0:''})}}>
          <span
                 {% if contrib.parent == 0 %}
                 style="display:none"
                 {% endif %}>
            ^</span>
          </td>

        <td>
          {% if contrib.moderation == 0 %}
          <input
             type="text" id="contrib-duplicate[{{contrib.id}}]"
             class="contrib-duplicates contrib-duplicate[{{contrib.parent}}]"
             value="{{ contrib.parent }}" style="width:95%">
          {% endif %}
        </td>

        <td>
          <input
             type="text" id="contrib-part[{{contrib.id}}]"
             class="contrib-parts contrib-part[{{contrib.part}}]"
             value="{{ contrib.part }}" style="width:95%">
        </td>

        <td id="contrib-theme[{{contrib.id}}]"
            class="contrib-theme">
          <select
             class="wpgd-theme wpgd-the-theme[{{contrib.theme}}]"
             id="wpgd-theme-id[{{contrib.id}}]" name="theme">
            <option
               name="cuidado"
               {% if contrib.theme == 'cuidado' %} selected {% endif %}>
              cuidado
            </option>
            <option
               name="familia"
               {% if contrib.theme == 'familia' %} selected {% endif %}>
              familia
            </option>
            <option
               name="emergencia"
               {% if contrib.theme == 'emergencia' %} selected {% endif %}>
              emergencia
            </option>
            <option
               name="medicamentos"
               {% if contrib.theme == 'medicamentos' %} selected {% endif %}>
              medicamentos
            </option>
            <option
               name="regional"
               {% if contrib.theme == 'regional' %} selected {% endif %}>
              regional
            </option>
          </select>
        </td>

        <td>{{ contrib.creation_date|date("d/m/Y") }}</td>

        <td>
          <a href="{{siteurl}}/wp-admin/user-edit.php?user_id={{ contrib.user_id }}">
            {{ contrib.display_name }}
          </a>
        </td>

        <td id="contrib-title[{{contrib.id}}]"
            class="contribution-title">{{ contrib.title }}</td>
        <td id="contrib[{{contrib.id}}]"
            class="contribution">{{ contrib.content }}</td>
      </tr>
      {% endfor %}
    </tbody>

    <tfoot>
      <tr>
        <th classs="manage-column sortable desc" scope="col">ID</th>
        <th classs="manage-column sortable desc" scope="col">Approved?</th>
        <th classs="manage-column sortable desc" scope="col">Duplicate of</th>
        <th classs="manage-column sortable desc" scope="col">Part of</th>
        <th classs="manage-column sortable asc" scope="col">Theme</th>
        <th classs="manage-column sortable desc" scope="col">Creation Date</th>
        <th classs="manage-column sortable desc" scope="col">Author</th>
        <th classs="manage-column sortable desc" scope="col">Title</th>
        <th classs="manage-column sortable asc" scope="col">Content</th>
      </tr>
    </tfoot>
  </table>
  {% if paged > 0 %}
  <a href="{{pageurl}}&paged={{paged-1}}">previous</a>
  {% else %}
  previous
  {% endif %}
  ({{paged+1}}/{{numpages}})
  {% if count / perpage >  (paged+1) %}
    <a href="{{pageurl}}&paged={{paged+1}}">next</a>
  {% else %}
    next
  {% endif %}
</div>
